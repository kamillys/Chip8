# Use the latest 2.1 version of CircleCI pipeline process engine. See: https://circleci.com/docs/2.0/configuration-reference
# version: 2.1
parameters:
  docker_image:
    type: string
    default: 'gcc:8.2'

step-install-deps: &step-install-deps
  run:
    name: Install project dependencies
    command: |
      apt update
      apt install -y cmake libsdl2-dev

checkout:
  post:
    - git submodule init
    - git submodule update

step-test: &step-test
  run:
    name: Perform tests
    command: |
      mkdir build
      cd build
      cmake -DCMAKE_BUILD_TYPE=Debug ..
      cmake --build .
      ./Chip8_tests

version: 2
jobs:
  perform_test:
    docker:
      - image: << parameters.docker_image >>
    resource_class: small
    steps:
      - checkout
      - *step-install-deps
      - *step-test

workflows:
  version: 2
  build-linux:
    jobs:
       - perform_test
